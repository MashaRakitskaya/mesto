(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n,o){var r=e.data,i=e.handleCardClick,a=e.handleBasketClick,c=e.handleLikeClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._photo=r.link,this._title=r.name,this._numberLike=r.likes,this._handleCardClick=i,this._id=r._id,this._cardSelector=n,this._handleBasketClick=a,this._userId=o,this._isLiked=!1,this._handleLikeClick=c,this._owner=r.owner._id===o}var n,o;return n=t,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){this._element=this._getTemplate(),this._setEventListeners();var e=this._element.querySelector(".element__image");return this._element.querySelector(".element__title").textContent=this._title,e.src=this._photo,e.alt=this._title,this._element.querySelector(".element__number").textContent=this._numberLike.length,this._rendereLike(this._clickedLike(this._numberLike)),this._owner?this._element.querySelector(".element__basket").style.visibility="visible":this._element.querySelector(".element__basket").style.visibility="hidden",this._element}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__like").addEventListener("click",(function(){e._handleLikeClick(e._id,e._isLiked)})),this._element.querySelector(".element__basket").addEventListener("click",(function(){e._handleBasketClick(e)})),this._element.querySelector(".element__image").addEventListener("click",(function(){e._handleCardClick()}))}},{key:"deleteCard",value:function(){this._element.remove(),this._element=null}},{key:"getId",value:function(){return this._id}},{key:"_clickedLike",value:function(e){var t=this;return e.some((function(e){return e._id===t._userId}))}},{key:"_rendereLike",value:function(e){!0===e?(this._element.querySelector(".element__like").classList.add("element__like_pressed"),this._isLiked=!0):(this._element.querySelector(".element__like").classList.remove("element__like_pressed"),this._isLiked=!1)}},{key:"likeStatus",value:function(e){this._element.querySelector(".element__number").textContent=e.likes.length,this._rendereLike(this._clickedLike(e.likes))}}])&&e(n.prototype,o),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._formSelector=n,this._inputSelector=t.inputSelector,this._formElement=document.querySelector(this._formSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector))}var t,o;return t=e,(o=[{key:"_showError",value:function(e,t){var n=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._config.inputErrorClass),n.textContent=t,n.classList.add(this._config.errorClass)}},{key:"_hideError",value:function(e){var t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?this.disableButton(t):this.removeDisableButton(t)}},{key:"_setEventListeners",value:function(e){var t=this;this._toggleButtonState(this._inputList,e),this._inputList.forEach((function(n){n.addEventListener("input",(function(){t._checkInputValidity(n),t._toggleButtonState(t._inputList,e)}))}))}},{key:"disableButton",value:function(e){e.classList.add(this._config.buttonInvalidClass),e.disabled=!0}},{key:"removeDisableButton",value:function(e){e.classList.remove(this._config.buttonInvalidClass),e.disabled=!1}},{key:"enableValidation",value:function(){var e=this._formElement.querySelector(this._config.submitButtonSelector);this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(e)}},{key:"resetForm",value:function(e){var t=this;e.reset(),this._inputList.forEach((function(e){t._hideError(e)}))}}])&&n(t.prototype,o),e}(),r=document.querySelector(".elements"),i=(document.querySelector(".popup__close"),document.querySelector(".profile__edit-button")),a=document.querySelector(".profile__add-button"),c=document.querySelector(".popup_type_edit-profile"),u=document.querySelector(".popup_type_add-photo"),s=document.querySelector(".popup_type_big-photo"),l=(document.querySelector(".popup__close_type_close-photo"),document.querySelector(".popup__close_type_close-big-foto"),document.querySelector(".profile__title")),f=document.querySelector(".profile__paragraph"),p=document.querySelector(".popup__input_type_name"),h=document.querySelector(".popup__input_type_title"),_=document.querySelector(".popup__form_type_edit-profile"),d=document.querySelector(".popup__form_type_add-photo"),y=document.querySelector(".popup__save_type_edit"),m=document.querySelector(".popup__save_type_photo"),v=document.querySelector(".popup_type_update-avatar"),b=document.querySelector(".profile__avatar"),k=document.querySelector(".popup__form_type_update-avatar"),S=document.querySelector(".popup__save_type_avatar"),g=(document.querySelector(".popup__input_type_avatar-photo"),document.querySelector(".popup_type_deleteСard")),E=(document.querySelector(".element__basket"),document.querySelector(".profile__avatar-container"));function C(e,t){t.textContent=e?"Сохранение...":t.value}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var L=function(){function e(t,n){var o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=o,this._container=n}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e,t){!0===t?this._container.prepend(e):this._container.append(e)}}])&&w(t.prototype,n),e}();function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=t,this._handleEscClose=this._handleEscClose.bind(this),this._handleByOverlayClose=this._handleByOverlayClose.bind(this),this._handleByCross=this._handleByCross.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose),this._popupElement.addEventListener("click",this._handleByOverlayClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose),this._popupElement.removeEventListener("click",this._handleByOverlayClose)}},{key:"_handleEscClose",value:function(e){27==e.keyCode&&this.close()}},{key:"_handleByOverlayClose",value:function(e){e.target.classList.contains("popup")&&this.close()}},{key:"_handleByCross",value:function(e){e.target.classList.contains("popup__close")&&this.close()}},{key:"setEventListeners",value:function(){this._popupElement.addEventListener("click",this._handleByCross)}}])&&O(t.prototype,n),e}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(o);if(r){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupPhoto=t._popupElement.querySelector(".popup__photo"),t._caption=t._popupElement.querySelector(".popup__caption"),t}return t=a,(n=[{key:"open",value:function(e){I(T(a.prototype),"open",this).call(this),this._popupPhoto.src=e.link,this._caption.textContent=e.name}}])&&P(t.prototype,n),a}(q);function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var D=function(){function e(t){var n=t.nameSelector,o=t.occupationSelector,r=t.avatarSelector,i=t.id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameSelector=n,this._occupationSelector=o,this._avatarSelector=r,this._id=i}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._nameSelector.textContent,occupation:this._occupationSelector.textContent,avatar:this.avatar,id:this._id}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.occupation,o=e.avatar,r=e._id;this._nameSelector.textContent=t,this._occupationSelector.textContent=n,this._avatarSelector.src=o,this._id=r}}])&&x(t.prototype,n),e}();function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function F(e,t,n){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=J(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=J(o);if(r){var n=J(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return N(this,e)});function a(e){var t,n=e.popupElement,o=e.handleSubmitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,n))._handleSubmitForm=o,t._formElement=t._popupElement.querySelector(".popup__form"),t}return t=a,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._formElement.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;F(J(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._handleSubmitForm(e._getInputValues())}))}},{key:"close",value:function(){F(J(a.prototype),"close",this).call(this),this._formElement.reset()}}])&&V(t.prototype,n),a}(q);function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var G=function(){function e(t){var n=t.address,o=t.token;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._address=n,this._token=o}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._address,"/cards"),{headers:{authorization:this._token}}).then((function(t){return e._checkAnswerCorrectness(t)}))}},{key:"getUserInformation",value:function(){var e=this;return fetch("".concat(this._address,"/users/me"),{headers:{authorization:this._token}}).then((function(t){return e._checkAnswerCorrectness(t)}))}},{key:"addCard",value:function(e){var t=this;return fetch("".concat(this._address,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"removeCard",value:function(e){var t=this;return fetch("".concat(this._address,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token}}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"addLike",value:function(e){var t=this;return fetch("".concat(this._address,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"deleteLike",value:function(e){var t=this;return fetch("".concat(this._address,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"addUserInfo",value:function(e){var t=this;return fetch("".concat(this._address,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"addUserAvatar",value:function(e){var t=this;return fetch("".concat(this._address,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then((function(e){return t._checkAnswerCorrectness(e)}))}},{key:"_checkAnswerCorrectness",value:function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}}])&&M(t.prototype,n),e}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function W(e,t,n){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(o);if(r){var n=Z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Y(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._formElement=t._popupElement.querySelector(".popup__form_type_deleteСard"),t}return t=a,(n=[{key:"setSubmitAction",value:function(e){this._handleSubmitCallback=e}},{key:"setEventListeners",value:function(){var e=this;W(Z(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._handleSubmitCallback()}))}},{key:"close",value:function(){W(Z(a.prototype),"close",this).call(this)}}])&&Q(t.prototype,n),a}(q),ee=new G({address:"https://mesto.nomoreparties.co/v1/cohort-19",token:"369f7f82-3628-418a-9ccf-d1d1496569f6"}),te=function(e){var n=new t({data:e,handleCardClick:function(){oe.open(e)},handleBasketClick:function(e){ue.open(),ue.setSubmitAction((function(){ee.removeCard(e.getId()).then((function(){return e.deleteCard()}),ue.close()).catch((function(e){return console.log("Ошибка при удалении карточки ".concat(e))}))}))},handleLikeClick:function(e,t){!1===t?ee.addLike(e).then((function(e){n.likeStatus(e)})).catch((function(e){return console.log("Ошибка при добавлении лайка ".concat(e))})):ee.deleteLike(e).then((function(e){n.likeStatus(e)})).catch((function(e){return console.log("Ошибка при удалении лайка ".concat(e))}))}},"#card-template",re.getUserInfo().id);return n.generateCard()},ne=new L({renderer:function(e){ne.addItem(te(e),!1)}},r),oe=new A(s);oe.setEventListeners(),i.addEventListener("click",(function(){ae.open(),le.resetForm(_),le.removeDisableButton(y);var e=re.getUserInfo();p.value=e.name,h.value=e.occupation})),a.addEventListener("click",(function(){ie.open(),le.resetForm(d),le.disableButton(m)})),E.addEventListener("click",(function(){ce.open(),le.resetForm(k),le.disableButton(S)})),Promise.all([ee.getUserInformation(),ee.getInitialCards()]).then((function(e){re.setUserInfo({name:e[0].name,occupation:e[0].about,avatar:e[0].avatar,_id:e[0]._id}),ne.renderItems(e[1])})).catch((function(e){return console.log("Ошибка получения информации".concat(e))}));var re=new D({nameSelector:l,occupationSelector:f,avatarSelector:b}),ie=new H({popupElement:u,handleSubmitForm:function(e){C(!0,m),ee.addCard({name:e.place,link:e.photo}).then((function(e){ne.addItem(te(e),!0),ie.close()})).catch((function(e){return console.log("Ошибка добавления карточки ".concat(e))})).finally((function(){C(!1,m)}))}});ie.setEventListeners();var ae=new H({popupElement:c,handleSubmitForm:function(e){C(!0,y),ee.addUserInfo({name:e.profileName,about:e.occupation}).then((function(e){re.setUserInfo({name:e.name,occupation:e.about,avatar:e.avatar,_id:e._id}),ae.close()})).catch((function(e){return console.log("Ошибка редактирования информации о пользователе ".concat(e))})).finally((function(){C(!1,y)}))}});ae.setEventListeners();var ce=new H({popupElement:v,handleSubmitForm:function(e){C(!0,S),ee.addUserAvatar({avatar:e.avatar}).then((function(e){b.src=e.avatar,ce.close()})).catch((function(e){return console.log("Ошибка редактирования аватарки".concat(e))})).finally((function(){C(!1,S)}))}});ce.setEventListeners();var ue=new $(g);ue.setEventListeners();var se={inputSelector:".popup__input",submitButtonSelector:".popup__save",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error",buttonInvalidClass:"popup__save_disabled"},le=new o(se,".popup__form_type_edit-profile"),fe=new o(se,".popup__form_type_add-photo"),pe=new o(se,".popup__form_type_update-avatar");le.enableValidation(),fe.enableValidation(),pe.enableValidation()})();